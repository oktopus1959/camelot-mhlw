# camelot-mhlw
厚生労働省サイトが提供している【別紙１】「各都道府県の検査陽性者の状況（空港・海港検疫、チャーター便案件を除く国内事例）」PDFファイル （[例](https://www.mhlw.go.jp/content/10906000/000747891.pdf)）から各都道府県の陽性者数や検査数などのデータを抽出するための docker イメージを構築する Dockerfile と、抽出に用いる python スクリプトです。

camelot という python モジュールを利用しています。

実際に抽出した日々のテキストファイルも格納してあります。

このデータは、「[新型コロナ 陽性者数グラフ](https://ncov.oktopus59.net/)」で使われています。


## Docker イメージのビルド
### docker コマンドを実行する場合
``` shell
docker build -t camelot-mhlw .
```
タグ名は適当に変更してください。

### docker-compose を用いる場合
``` shell
docker-compose build
```
イメージのタグ名は "camelot-mhlw" になります。

## PDFからテキスト抽出を実行
まず、次のコマンドを実行してください。（タグ名はビルド時に付けた名前を使ってください）
``` shell
docker run --rm -v $(pwd)/mhlw_pdf:/mhlw_pdf camelot-mhlw sh /root/latest_pdf_to_text.sh
```
または docker-compose を使って
``` shell
docker-compose run --rm camelot
```
でも結構です。

標準出力に次のようなデータが表示されればOKです。
```
PDF_FILE|/mhlw_pdf/20210303.pdf
都道府県名|陽性者数|PCR検査 実施人数|入院治療等を 要する者 （人）||退院又は療養解除 となった者の数 （人）|死亡（累積） （人）
||||うち重症||
北 海 道|19,151|383,402|543|4|17,944|684
青 森|817|17,538|26|1|771|20
[中略]
鹿 児 島|1,762|67,958|32|2|1,729|27
沖 縄|8,217|145,750|273|1|7,829|120
（その他）|149|-|0|-|149|-
合計|432,101|7,877,039|12,738|407|411,132|7,982
確認中 （人）
[後略]
```

新しいPDFをダウンロードしたら、`yyyymmdd.pdf` 形式の名前にして `mhlw_pdf/` ディレクトリに格納してから上記コマンドを実行してください。最新日付のPDFファイルに対してテキスト抽出が実行されます。

なお、日々抽出したテキストファイルを `mhlw_pref` ディレクトリに格納してあります（PDFファイルとは日付が1日ずれているので注意）。毎日更新予定。

テキストファイルをcsvなどに整形する方法については `tools/make_pref_data.rb` を参考にしてください。

## PDFファイルの取得
`tools/extract_today_pref_data.sh` を実行すると、厚労省サイトから(もし更新されていれば)当日分のPDFファイルをダウンロードして、テキスト抽出したファイルが作成されます。
なお、月が変わったら、 `pageUrl` 変数を修正してください。

## 作者
Twitter: [@oktopus59](https://twitter.com/oktopus59) (OKA Toshiyuki)

何かご意見・ご要望があれば上記アカウントまでお願いします。
